{
    "instruction":"你是一个具有丰富银行金融业务经验的专家,同时你精通 PlantUML 语法。您的目的是帮助用户理解业务流程，提供业务功能整个过程的流程展示。您的任务是根据用户提供的交易描述内容使用 PlantUML DSL 生成交易流程图。\n<具体要求>\n1. 使用 PlantUML 活动图（Activity Diagram）语法描述业务流程。\n2. 生成单一、完整的流程图，不拆分。\n3. 确保 PlantUML 语法逻辑描述的正确性。\n4. 严格遵守 PlantUML 语法规则，确保生成的代码可以被 PlantUML 解析器正确解析。\n5. 确保所有的消息流向（箭头）使用正确。\n6. 确保没有悬空或未闭合的结构。\n7. 将复杂的业务逻辑简化为基本的流程步骤。\n8. 使用简洁明了的描述，避免过长的文本可能导致的格式问题。\n9. 限制使用以下 PlantUML 元素：start, stop, if/else, while, fork, join, :action, note, partition。\n10. 使用默认样式和颜色，不添加额外的样式指令。\n11. 适当使用 note 来解释重要步骤或决策点，但不要过度使用。\n<错误检查列表>\n生成代码后，请检查以下几点：\n1. 确保 start 和 stop 只出现一次。\n2. 检查所有的 if/else 结构是否正确闭合。\n3. 确保所有的 while 循环都有明确的结束条件。\n4. 检查是否存在任何悬空的节点或箭头。\n5. 确保所有的 note 都正确附加到相应的活动或决策点。\n<输出格式>\n仅输出完整的 PlantUML 代码，包括 @startuml 和 @enduml 标记。不要包含任何解释或额外文本。确保代码块正确封装。格式如下：\n@startuml\nxxxx\nxxxx\nxxxx\n@enduml\n在生成代码时，请保守行事，宁可牺牲一些复杂度，也要确保生成的代码 100% 可以被 PlantUML 解析。如果您对某个语法结构有任何疑虑，请选择更简单、更可靠的替代方案。 ",
    "input":"请根据以下交易描述并学习参考示例生成相应的 PlantUML 活动图代码：\n<交易描述>\n# 交易名称:柜面收费\n## 交易-服务编排逻辑\n### 检查个人存款产品合约账户支取条件\n#### 服务业务规则该方法主要用于检查个人存款账户支取条件,业务规则如下\n1. 该方法主要用于检查个人存款账户支取条件\n  1.1 根据资金账号获取账户信息，若为空则报错:\"YACTB001-账户{}不存在\"\n  1.2 调用【个人存款账户】领域对象的【检查个人存款账户资金支取条件checkDrawAcctFund】方法\n  1.3 该方法主要用于检查个人存款账户支取条件\n      1.3.1 输入字段检查，如下：\n          1.3.1.1 如果【输入.交易金额】为空或为0，报错：\"YACTB077-交易金额不能为空或为0\"\n          1.3.1.2 如果【输入.交易币种】!=\"156-人民币\"且【输入.钞汇标志】为空，报错：\"YACTB078-外币交易，必须上送钞汇标志\"\n          1.3.1.3 如果【输入.交易币种】!=\"156-人民币\"，检查如下：\n              1.3.1.3.1 如果【this.钞汇标志】!=[输入.钞汇标志]，报错：\"YACTB017-钞汇标志不一致\"\n              1.3.1.3.2 如果【this.钞汇标志】==\"现钞”且【输入.现转标志】!=\"现金\"，报错：“YACTB079-当前账户为现钞账户，不允许转账支取”\n              1.3.1.3.3 如果【this.钞汇标志】==\"现汇”且【输入.现转标志】!=\"转账\"，报错：“YACTB080-当前账户为现汇账户，不允许现金支取”\n          1.3.1.4 如果【this.账户币种代码】!=[输入.交易币种]，报错：“YACTB081-交易币种与账户币种不一致”\n          1.3.1.5 如果【输入.交易金额】<=0，报错：“YACTB082-交易金额不能小于等于0”\n      1.3.2 检查账户状态，如下：\n          1.3.2.1 如果【this.账户状态.账户状态】!=\"正常\"，报错：“YACTB083-账户状态为转营业外收入，不允许支取资金”\n          1.3.2.2 如果【this.控制措施组合.限制状态】==\"只收不付\"或者\"封闭冻结\"，报错：“YACTB084-账户已被冻结控制，不允许支取资金”\n      1.3.3 未当面核实的II/III类账户，不允许取现:\n          1.3.3.1 如果【this.账户属性】==\"302-II类账户\"或\"303-III类账户\"且【this.是否面核标志】==\"否”且【输入.现转标志】==\"现金\",报错：“YACTB085-未当前核实的二三类账户不允许支取现金”\n      1.3.4 检查账户可用资金余额，如下：\n          1.3.4.1 调用方法【this.计算可用资金余额calcAvlFundBal】得到返回的#账户可用资金余额，如果#账户可用资金余额<【输入.交易金额】，报错：\"YACTB086-账户可用余额不足\"\n      1.3.5 如果【this.最小留存余额】!=0，则检查账户最小留存余额，如下：\n          1.3.5.1 计算#支取后账户余额 = 【this.账户余额.当前账户余额】 - 交易金额，如果#支取后账户余额 < 【this.最小留存余额】，报错：\"YACTB087-交易后余额小于账户最小留存余额，请进行销户\"\n      1.3.6 限额检查，如下：\n          1.3.6.1 构建限额检查方法的输入【统一限额检查输入BaseLimit.CompChkLmtIn】，设置如下值：\n              1.3.6.1.1 统一限额检查输入.限额场景 = \"NOMALZQ\"；(转成List)\n              1.3.6.1.2 统一限额检查输入.限额检查范围 = \"11\"\n              1.3.6.1.3 统一限额检查输入.额度层次输入.Key = \"系统账号层\"(这里用额度层次对应枚举转换成字符串)\n              1.3.6.1.4 统一限额检查输入.额度层次输入.Value = this.资金账号\n              1.3.6.1.5 统一限额检查输入.限额检查类型 = \"查询\"\n              1.3.6.1.6 统一限额检查输入.账户所属机构号 = this.账户所属机构号\n              1.3.6.1.7 统一限额检查输入.交易金额 = 支取个人存款账户资金输入.交易金额\n          1.3.6.2 调用公共机制sdk【统一限额处理LimitCompleteAps】的[completeLimitCheck]进行限额设置\n  1.4 判断整存整取支取时是否为提前支取\n      1.4.1 如果【this.定活标志】 == \"1-定期产品\" 且【this.账户分类】 == \"2001-整存整取账户\"\n          1.4.1.1 如果【输入.交易日期】 < 【this.到期日】，则【输出.支取类型】 = \"EARLY_WITHDRAWAL-提前支取\"\n          1.4.1.2 否则【输出.支取类型】 = \"NORMAL_WITHDRAWAL-正常支取\"\n2. 该方法主要用于查询账户\n  2.1 定义要返回的【个人存款账户】领域对象psDepositAccount\n  2.2 如果输入定活标志demandOrTimeFlag值为\"0-活期产品\"或为空，则处理如下：\n      2.2.1 根据资金账号fundAcctNo查询【活期存款账户表kc_acct_curt】，获取对应数据库PO对象\n      2.2.2 如果对应数据库PO对象存款，则进行如下处理：\n          2.2.2.1 根据【活期存款账户表kc_acct_curt】数据库PO对象构建【账户状态】【账户余额】\n          2.2.2.2 根据PO对象.账户分类构建对应领域对象，如下：\n              2.2.2.2.1 如果PO对象.账户分类 ==\"3001-电子现金账户，则通过【活期存款账户表kc_acct_curt】数据库PO对象、【账户状态】、【账户余额】构建【电子现金账户】领域对象；(电子现金账户.账户补登余额 = PO对象.备用金额)\n              2.2.2.2.2 否则，如果PO对象.账户分类 !=\"3001-电子现金账户，则处理如下：\n                  2.2.2.2.2.1 如果账户为二三类户(PO对象.账户属性==CLASS2_ACCT_302或“303”）,则根据资金账号fundAcctNo查询【绑定一类户登记簿kb_acct_bind_classi】（结果为list），如果记录存在，则将查询结果转换成【绑定I类账户登记簿】领域对象列表\n                  2.2.2.2.2.2 根据【活期存款账户表kc_acct_curt】数据库PO对象、【账户状态】、【账户余额】、【绑定I类账户登记簿】领域对象列表构建成【个人活期存款账户】领域对象\n          2.2.2.3 通过se设置【个人存款账户】的[定活标志]==\"0-活期\"\n  2.3 如果输入定活标志demandOrTimeFlag值为\"1-定期产品\"或为空且领域对象psDepositAccount为空，则处理如下：\n      2.3.1 根据资金账号fundAcctNo查询【活期存款账户表kc_acct_fixb】,如果记录不存在，返回null\n      2.3.2 根据【活期存款账户表kc_acct_curt】数据库PO对象构建【账户状态】【账户余额】\n      2.3.3 根据PO对象.账户分类构建对应领域对象，如下：\n          2.3.3.1 如果PO对象.账户分类 == \"2001-整存整取账户\"，则通过【定期存款账户表kc_acct_fixb】数据库PO对象、【账户状态】、【账户余额】构建【个人整存整取存款账户】领域对象\n          2.3.3.2 如果PO对象..账户分类 == \"2002-零存整取账户\"，则通过【定期存款账户表kc_acct_fixb】数据库PO对象、【账户状态】、【账户余额】构建为【个人零存整取存款账户】领域对象\n          2.3.3.3 如果PO对象.账户分类 == \"2003-整存零取账户\"，则通过【定期存款账户表kc_acct_fixb】数据库PO对象、【账户状态】、【账户余额】构建为【个人整存零取款账户】领域对象\n          2.3.3.4 如果PO对象.账户分类 == \"2004-存本取息账户\"，则通过【定期存款账户表kc_acct_fixb】数据库PO对象、【账户状态】、【账户余额】构建为【个人存本取息存款账户】领域对象\n          2.3.3.5 如果PO对象.账户分类 == \"2005-通知存款账户\"，则通过【定期存款账户表kc_acct_fixb】数据库PO对象、【账户状态】、【账户余额】构建为【个人通知存款账户】领域对象\n      2.3.4 通过se设置【个人存款账户】的[定活标志]==\"1-定期\"\n  2.4 获取账户冻结控制信息，如下：\n      2.4.1 创建【控制措施PsDepositControl】空列表\n      2.4.2 根据[资金账号]fundAcctNo查询【账户冻结控制登记簿kb_acct_rstrct】所有[解控标志=\"控制\"]的所有记录（可能0条或多条)，根据查询结果处理如下：\n          2.4.2.1 如果记录不为空，循环遍历所有PO对象，将PO对象转换成【控制措施PsDepositControl】领域对象，并添加到【控制措施PsDepositControl】列表中\n      2.4.3 通过构造方法(构造方法输入：【控制措施 PsDepositControl】列表)构建【控制措施组合PsDepositControlCompose】领域对象，并将此领域对象通过set方法赋值给【个人存款账户】的[控制措施组合]字段\n3. 该方法主要用于调用限额组件进行指定限额检查\n  3.1 使用客户指定限额检查\n      3.1.1 构建【统一限额检查输入BaseLimit.CompChkLmtIn】\n          3.1.1.1 统一限额检查输入.限额检查类型 = 【参数.限额检查类型】\n          3.1.1.2 统一限额检查输入.业务场景 = 【参数.业务场景】\n          3.1.1.3 统一限额检查输入.额度币种 = 【参数.额度币种】\n          3.1.1.4 统一限额检查输入.产品代码 = 【参数.产品代码】\n          3.1.1.5 统一限额检查输入.账户所属机构号 = 【参数.账户所属机构号】\n          3.1.1.6 统一限额检查输入.交易金额 = 【参数.交易金额】\n          3.1.1.7 统一限额检查输入.摘要代码控制组编号 = null\n          3.1.1.8 统一限额检查输入.额度层次对象 = 【参数.额度层次对象】\n      3.1.2 客户类指定限额服务\n4. 该方法主要用于调用限额组件中客户类全局限额检查\n  4.1 构建【统一限额检查输入BaseLimit.CompChkLmtIn】\n      4.1.1 统一限额检查输入.业务场景 = 【参数.业务场景】\n      4.1.2 统一限额检查输入.额度层次对象 = 【参数.额度层次对象】\n      4.1.3 统一限额检查输入.账户所属机构号 = 【参数.账户所属机构号】\n      4.1.4 统一限额检查输入.交易金额 = 【参数.交易金额】\n      4.1.5 统一限额检查输入.限额检查类型 = 【参数.限额检查类型】\n  4.2 客户类全局限额服务\n5. 该方法主要用于获取账户额度类余额\n  5.1 返回【账户额度类余额】\n### 支取个人存款账户资金\n#### 服务业务规则该方法主要用于支取个人存款账户资金,业务规则如下\n1. 业务规则-查询账户\n  1.1 查询账户\n  1.2 如果未查到账户信息,则报错:\"YACTB001-账户{}不存在\"\n2. 业务规则-查询账户利息信息\n  2.1 根据资金账号查询账户利息信息\n  2.2 如果未查到账户利息信息,则报错:\"YACTB007\"\n3. 业务规则-支取账户资金\n  3.1 校验可用资金余额和交易金额\n  3.2 如果可用资金余额加上交易限额小于交易金额,则报错:\"YACTB086\"\n  3.3 如果可用资金余额小于交易金额,则交易金额等于可用资金余额\n  3.4 更新账户余额\n  3.5 更新积数\n  3.6 检查限额\n    3.6.1 调用客户指定限额检查\n    3.6.2 检查校验结果\n    3.6.3 调用客户类全局限额检查\n    3.6.4 检查校验结果\n4. 业务规则-更新账户余额\n  4.1 根据账户类型更新账户余额\n  4.2 更新账户基本信息\n  4.3 更新账户余额到数据库\n5. 业务规则-更新账户利息信息\n  5.1 根据账户利息信息查询【账户利息定义表kb_acct_interest】\n  5.2 更新账户利息积数\n  5.3 更新账户利息定义表到数据库\n6. 业务规则-登记余额变化明细\n  6.1 根据方法输入对字段赋值\n  6.2 根据对手方信息对对手方信息字段赋值\n  6.3 根据代理人对象信息对代理人信息字段赋值\n  6.4 根据公共上下文环境对如下字段赋值\n    6.4.1 余额变化明细.渠道代码\n    6.4.2 余额变化明细.第三方交易码\n    6.4.3 余额变化明细.内部交易码\n    6.4.4 余额变化明细.交易营业机构\n    6.4.5 余额变化明细.交易柜员\n    6.4.6 余额变化明细.授权柜员\n    6.4.7 余额变化明细.交易日期\n    6.4.8 余额变化明细.交易时间\n    6.4.9 余额变化明细.柜员流水号\n    6.4.10 余额变化明细.主机日期\n    6.4.11 余额变化明细.冲正标志\n    6.4.12 余额变化明细.被冲正标志\n    6.4.13 余额变化明细.IP地址\n    6.4.14 余额变化明细.终端号\n    6.4.15 余额变化明细.三方流水号\n    6.4.16 余额变化明细.第三方日期\n7. 业务规则-登记会计核算流水\n  7.1 登记会计核算流水\n  7.2 根据账户信息对会计核算流水字段赋值\n  7.3 根据业务事件方式设置会计核算流水\n  7.4 根据业务代码设置会计核算流水\n  7.5 根据产品代码设置会计核算流水\n8. 业务规则-登记冲正事件\n  8.1 登记冲正事件\n  8.2 根据冲正条件输入对冲正事件字段赋值\n9. 业务规则-构建输出\n  9.1 构建应用服务输出\n  9.2 根据输入对输出进行赋值\n  9.3 根据账户信息对输出字段赋值\n</交易描述>\n示例参考：\n以下是一个简单的 PlantUML 活动图示例，包含 note 和 partition 的使用，仅供参考：\n@startuml\nstart\n:接收存款证明重打请求;\nnote right: 包括存款证明登记号和申请份数\nif (存在有效存款证明信息?) then (是)\npartition \"重打个人存款证明\" {\n:更新个人存款证明子合约;\nnote left\n累计打印次数 +1\n累计签发份数 + 申请份数\n记录状态 = '有效'\nend note\n:更新符合条件的凭证关系信息;\nnote right\n  更新打印日期\n  更新打印次第数\n  记录状态 = '有效'\n  数据更新标志 = '已更新'\nend note\n}\n:更新个人存款证明基本信息;\nnote left: 调用仓储服务\n:登记个人存款证明变更历史;\nnote right: 调用仓储服务\n:生成新的存款证明;\nelse (否)\n:报错: 无有效存款证明信息;\nendif\n:返回处理结果;\nstop\n@enduml",
    "chosen":"@startuml\nstart\n:柜面收费;\n\npartition \"检查个人存款产品合约账户支取条件\" {\n    :根据资金账号获取账户信息;\n    if (账户信息为空?) then (是)\n        :报错: YACTB001-账户不存在;\n        stop\n    else (否)\n        :调用【个人存款账户】领域对象的【检查个人存款账户资金支取条件checkDrawAcctFund】方法;\n        note right\n            检查输入字段、账户状态、II/III类账户取现限制、\n            账户可用资金余额、最小留存余额、限额等\n        end note\n    endif\n    \n    if (账户为整存整取账户?) then (是)\n        if (交易日期 < 到期日?) then (是)\n            :设置支取类型为提前支取;\n        else (否)\n            :设置支取类型为正常支取;\n        endif\n    endif\n}\n\npartition \"查询账户\" {\n    if (输入定活标志为活期或空?) then (是)\n        :根据资金账号查询活期存款账户表;\n        if (记录存在?) then (是)\n            :构建账户状态和余额对象;\n            if (账户分类为电子现金账户?) then (是)\n                :构建电子现金账户领域对象;\n            else (否)\n                if (账户为II/III类户?) then (是)\n                    :查询绑定I类户登记簿;\n                    :构建绑定I类账户登记簿领域对象列表;\n                endif\n                :构建个人活期存款账户领域对象;\n            endif\n        endif\n    else (否)\n        :根据资金账号查询定期存款账户表;\n        if (记录不存在?) then (是)\n            stop\n        endif\n        :根据账户分类构建对应的定期存款账户领域对象;\n    endif\n    \n    :获取账户冻结控制信息;\n    :构建控制措施组合领域对象;\n}\n\npartition \"支取个人存款账户资金\" {\n    :查询账户;\n    if (未查到账户信息?) then (是)\n        :报错: YACTB001-账户不存在;\n        stop\n    endif\n    \n    :查询账户利息信息;\n    if (未查到账户利息信息?) then (是)\n        :报错: YACTB007;\n        stop\n    endif\n\n    :校验可用资金余额和交易金额;\n    if (可用资金余额+交易限额 < 交易金额) then (是)\n        :报错: YACTB086;\n        stop\n    else (否)\n        if (可用资金余额 < 交易金额) then (是)\n            :交易金额 = 可用资金余额;\n        endif\n    endif\n    \n    :更新账户余额;\n    :更新积数;\n    :调用客户指定限额检查;\n    :调用客户类全局限额检查;\n    \n    :更新账户余额到数据库;\n    :更新账户利息积数;\n    :更新账户利息定义表到数据库;\n    \n    :登记余额变化明细;\n    note left\n        设置渠道代码、第三方交易码、内部交易码、\n        交易营业机构、交易柜员、授权柜员、交易日期、\n        交易时间、柜员流水号等字段\n    end note\n    \n    :登记会计核算流水;\n    :登记冲正事件;\n    \n    :构建应用服务输出;\n}\n\n:返回处理结果;\nstop\n@enduml\n",
    "rejected":"```plantuml\n@startuml\ntitle 柜面收费-服务业务规则\nstart\n:检查个人存款产品合约账户支取条件;\nnote right: 根据资金账号获取账户信息\nif (账户信息为空) then (是)\n:报错: \"YACTB001-账户{}不存在\";\nelse (否)\n:检查个人存款账户资金支取条件;\nnote right: 输入字段检查\nif (交易金额为空或为0) then (是)\n:报错: \"YACTB077-交易金额不能为空或为0\";\nelseif (交易币种!=\"156-人民币\"且钞汇标志为空) then (是)\n:报错: \"YACTB078-外币交易，必须上送钞汇标志\";\nelseif (交易币种!=\"156-人民币\") then (是)\nnote right: 钞汇标志检查\nif (钞汇标志不一致) then (是)\n:报错: \"YACTB017-钞汇标志不一致\";\nelseif (钞汇标志==\"现钞\"且现转标志!=\"现金\") then (是)\n:报错: \"YACTB079-当前账户为现钞账户，不允许转账支取\";\nelseif (钞汇标志==\"现汇\"且现转标志!=\"转账\") then (是)\n:报错: \"YACTB080-当前账户为现汇账户，不允许现金支取\";\nelseif (账户币种代码!=[交易币种]) then (是)\n:报错: \"YACTB081-交易币种与账户币种不一致\";\nelseif (交易金额<=0) then (是)\n:报错: \"YACTB082-交易金额不能小于等于0\";\nelse (否)\n:检查账户状态;\nnote right: 账户状态检查\nif (账户状态!=\"正常\") then (是)\n:报错: \"YACTB083-账户状态为转营业外收入，不允许支取资金\";\nelseif (控制措施组合.限制状态==\"只收不付\"或者\"封闭冻结\") then (是)\n:报错: \"YACTB084-账户已被冻结控制，不允许支取资金\";\nelse (否)\n:未当面核实的II/III类账户，不允许取现;\nnote right: 未当面核实的II/III类账户检查\nif (账户属性==\"302-II类账户\"或\"303-III类账户\"且是否面核标志==\"否\"且现转标志==\"现金\") then (是)\n:报错: \"YACTB085-未当前核实的二三类账户不允许支取现金\";\nelse (否)\n:检查账户可用资金余额;\nnote right: 账户可用资金余额检查\nif (账户可用资金余额<交易金额) then (是)\n:报错: \"YACTB086-账户可用余额不足\";\nelse (否)\n:检查账户最小留存余额;\nnote right: 账户最小留存余额检查\nif (最小留存余额!=0) then (是)\n:计算支取后账户余额;\nif (支取后账户余额 < 最小留存余额) then (是)\n:报错: \"YACTB087-交易后余额小于账户最小留存余额，请进行销户\";\nelse (否)\n:限额检查;\nnote right: 限额检查\n:构建统一限额检查输入;\n:调用统一限额处理SDK;\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif\nendif"
}